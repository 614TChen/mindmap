<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>æ€ç»´å¯¼å›¾æµ‹è¯•</title>
    <style>
        body {
            background: #fff;
            margin: 0;
            height: 100vh;
            font-family: Arial, sans-serif;
        }
        .grid-bg {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            width: 100vw;
            height: 100vh;
            background-image: linear-gradient(to right, #e0e0e0 1px, transparent 1px),
                              linear-gradient(to bottom, #e0e0e0 1px, transparent 1px);
            background-size: 40px 40px;
        }
        
        /* æ€ç»´å¯¼å›¾æ ·å¼ */
        .mindmap-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 999;
            max-width: 80vw;
            max-height: 80vh;
            overflow: auto;
        }
        
        .mindmap-node {
            background: #fff;
            border: 2px solid #1976d2;
            border-radius: 20px;
            padding: 15px 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            text-align: center;
            min-width: 200px;
            max-width: 300px;
            transition: all 0.3s ease;
            animation: nodeAppear 0.5s ease-out;
            position: relative;
            margin-bottom: 20px;
        }
        
        /* æ€ç»´å¯¼å›¾è¿æ¥çº¿ */
        .mindmap-connections {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }
        
        .connection-line {
            position: absolute;
            background: #1976d2;
            height: 3px;
            border-radius: 2px;
            box-shadow: 0 1px 3px rgba(25, 118, 210, 0.3);
            transform-origin: left center;
        }
        
        /* å­èŠ‚ç‚¹å®¹å™¨ - æ”¾å°„çŠ¶å¸ƒå±€ */
        .mindmap-children {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            margin-top: 40px;
            padding: 20px;
            position: relative;
            /* æ”¾å°„çŠ¶å¸ƒå±€çš„åŸºç¡€ */
            transform-style: preserve-3d;
        }
        
        /* ä¸ºä¸åŒä½ç½®çš„å­èŠ‚ç‚¹è®¾ç½®ä¸åŒçš„è§’åº¦ */
        .mindmap-child-node {
            background: #fff;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 12px 16px;
            text-align: center;
            min-width: 160px;
            max-width: 200px;
            transition: all 0.3s ease;
            position: relative;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        /* å­èŠ‚ç‚¹æ‚¬åœæ•ˆæœ */
        .mindmap-child-node:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        /* ç„¦ç‚¹å­èŠ‚ç‚¹æ ·å¼ */
        .mindmap-child-node.focused {
            border: 3px solid #ff6b35;
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.3);
            background: linear-gradient(135deg, #fff 0%, #fff8f5 100%);
        }
        
        .mindmap-child-node.focused::before {
            content: "ğŸ¯";
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 16px;
            background: #ff6b35;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 6px rgba(255, 107, 53, 0.4);
        }
        
        .mindmap-child-node .child-title {
            font-weight: bold;
            font-size: 14px;
            color: #333;
            margin-bottom: 5px;
        }
        
        .mindmap-child-node .child-content {
            font-size: 12px;
            color: #666;
            line-height: 1.3;
        }
        
        .mindmap-child-node.focused .child-title {
            color: #ff6b35;
        }
        
        .mindmap-node .node-title {
            font-weight: bold;
            font-size: 16px;
            color: #1976d2;
            margin-bottom: 8px;
        }
        
        .mindmap-node .node-content {
            font-size: 14px;
            color: #666;
            line-height: 1.4;
        }
        
        .mindmap-node .node-type {
            font-size: 12px;
            color: #999;
            margin-top: 8px;
            text-transform: uppercase;
        }
        
        .mindmap-node .node-close-btn {
            position: absolute;
            top: -8px;
            right: -8px;
            width: 24px;
            height: 24px;
            background: #ff4444;
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .mindmap-node .node-close-btn:hover {
            background: #cc0000;
        }
        
        @keyframes nodeAppear {
            from {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.5);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }
        
        /* æµ‹è¯•æŒ‰é’® */
        .test-controls {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .test-controls button {
            margin: 5px;
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            background: #1976d2;
            color: white;
            cursor: pointer;
        }
        
        .test-controls button:hover {
            background: #1565c0;
        }
    </style>
</head>
<body>
    <div class="grid-bg"></div>
    
    <!-- æµ‹è¯•æ§åˆ¶æŒ‰é’® -->
    <div class="test-controls">
        <h3>æ€ç»´å¯¼å›¾æµ‹è¯•</h3>
        <button onclick="showMindMap()">æ˜¾ç¤ºæ€ç»´å¯¼å›¾</button>
        <button onclick="hideMindMap()">éšè—æ€ç»´å¯¼å›¾</button>
        <button onclick="testRadialLayout()">æµ‹è¯•æ”¾å°„çŠ¶å¸ƒå±€</button>
    </div>
    
    <!-- æ€ç»´å¯¼å›¾å®¹å™¨ -->
    <div class="mindmap-container" id="mindmapContainer" style="display: none;">
        <div class="mindmap-connections" id="mindmapConnections">
            <!-- è¿æ¥çº¿å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
        </div>
        <div class="mindmap-node" id="mindmapNode">
            <button class="node-close-btn" id="nodeCloseBtn">Ã—</button>
            <div class="node-title" id="nodeTitle"></div>
            <div class="node-content" id="nodeContent"></div>
            <div class="node-type" id="nodeType"></div>
        </div>
        <div class="mindmap-children" id="mindmapChildren">
            <!-- å­èŠ‚ç‚¹å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
        </div>
    </div>

    <script>
        // æ¨¡æ‹Ÿæ•°æ®
        const mockNodeData = {
            "node_id": "main-001",
            "title": "Rocket Building Project",
            "content": "A comprehensive rocket building project with multiple phases",
            "node_type": "idea",
            "position": {"x": 0, "y": 0},
            "is_focused": false,
            "parent_node": null,
            "suggested_next": "Design Phase",
            "total_children": 5,
            "focus_node_id": "child-001",
            "focus_node_title": "Design Phase",
            "children": [
                {
                    "node_id": "child-001",
                    "title": "Design Phase",
                    "content": "Plan the rocket design and specifications",
                    "node_type": "subtask",
                    "is_focused": true
                },
                {
                    "node_id": "child-002",
                    "title": "Materials",
                    "content": "Select and source required materials",
                    "node_type": "subtask",
                    "is_focused": false
                },
                {
                    "node_id": "child-003",
                    "title": "Assembly",
                    "content": "Build and assemble the rocket components",
                    "node_type": "subtask",
                    "is_focused": false
                },
                {
                    "node_id": "child-004",
                    "title": "Testing",
                    "content": "Test the rocket systems and safety",
                    "node_type": "subtask",
                    "is_focused": false
                },
                {
                    "node_id": "child-005",
                    "title": "Launch",
                    "content": "Prepare and execute the rocket launch",
                    "node_type": "subtask",
                    "is_focused": false
                }
            ]
        };

        // æ˜¾ç¤ºæ€ç»´å¯¼å›¾
        function showMindMap() {
            const container = document.getElementById('mindmapContainer');
            const titleElement = document.getElementById('nodeTitle');
            const contentElement = document.getElementById('nodeContent');
            const typeElement = document.getElementById('nodeType');
            const childrenContainer = document.getElementById('mindmapChildren');
            const connectionsContainer = document.getElementById('mindmapConnections');
            const nodeElement = document.getElementById('mindmapNode');
            
            // è®¾ç½®ä¸»èŠ‚ç‚¹å†…å®¹
            titleElement.textContent = mockNodeData.title;
            contentElement.textContent = mockNodeData.content;
            typeElement.textContent = mockNodeData.node_type;
            
            // ä¸»èŠ‚ç‚¹ä¸æ˜¯ç„¦ç‚¹
            nodeElement.classList.remove('focused');
            
            // æ˜¾ç¤ºå®¹å™¨
            container.style.display = 'block';
            console.log('æ€ç»´å¯¼å›¾å®¹å™¨å·²æ˜¾ç¤º');
            
            // åˆ›å»ºå­èŠ‚ç‚¹
            if (mockNodeData.children && mockNodeData.children.length > 0) {
                childrenContainer.innerHTML = '';
                connectionsContainer.innerHTML = '';
                
                mockNodeData.children.forEach((childData, index) => {
                    const childElement = document.createElement('div');
                    childElement.className = 'mindmap-child-node';
                    childElement.dataset.nodeId = childData.node_id;
                    childElement.dataset.index = index;
                    
                    // è®¾ç½®ç„¦ç‚¹çŠ¶æ€
                    if (childData.is_focused) {
                        childElement.classList.add('focused');
                        console.log(`å­èŠ‚ç‚¹ ${childData.title} è®¾ç½®ä¸ºç„¦ç‚¹çŠ¶æ€`);
                    }
                    
                    childElement.innerHTML = `
                        <div class="child-title">${childData.title}</div>
                        <div class="child-content">${childData.content}</div>
                    `;
                    
                    // æ·»åŠ ç‚¹å‡»äº‹ä»¶
                    childElement.addEventListener('click', () => {
                        console.log(`ç‚¹å‡»å­èŠ‚ç‚¹: ${childData.title}`);
                        alert(`ç‚¹å‡»äº†å­èŠ‚ç‚¹: ${childData.title}`);
                    });
                    
                    childrenContainer.appendChild(childElement);
                });
                
                childrenContainer.style.display = 'flex';
                
                // åœ¨ä¸‹ä¸€å¸§åº”ç”¨æ”¾å°„çŠ¶å¸ƒå±€å’Œç»˜åˆ¶è¿æ¥çº¿
                setTimeout(() => {
                    applyRadialLayout();
                    drawConnectionLines();
                }, 100);
            }
            
            // æ·»åŠ å…³é—­æŒ‰é’®äº‹ä»¶
            const closeBtn = document.getElementById('nodeCloseBtn');
            closeBtn.onclick = hideMindMap;
        }
        
        // éšè—æ€ç»´å¯¼å›¾
        function hideMindMap() {
            const container = document.getElementById('mindmapContainer');
            container.style.display = 'none';
        }
        
        // åº”ç”¨æ”¾å°„çŠ¶å¸ƒå±€
        function applyRadialLayout() {
            const mainNode = document.getElementById('mindmapNode');
            const childrenContainer = document.getElementById('mindmapChildren');
            const childNodes = childrenContainer.querySelectorAll('.mindmap-child-node');
            
            if (!mainNode || childNodes.length === 0) {
                return;
            }
            
            const mainRect = mainNode.getBoundingClientRect();
            const containerRect = childrenContainer.getBoundingClientRect();
            
            // ä¸»èŠ‚ç‚¹ä¸­å¿ƒç‚¹
            const mainCenterX = mainRect.left + mainRect.width / 2;
            const mainCenterY = mainRect.top + mainRect.height / 2;
            
            const totalChildren = childNodes.length;
            const angleStep = 360 / totalChildren;
            const radius = 250; // æ”¾å°„çŠ¶åŠå¾„
            
            childNodes.forEach((childNode, index) => {
                // è®¡ç®—è§’åº¦ï¼ˆä»é¡¶éƒ¨å¼€å§‹ï¼Œé¡ºæ—¶é’ˆï¼‰
                const angle = (index * angleStep - 90) * (Math.PI / 180);
                
                // è®¡ç®—ä½ç½®
                const x = Math.cos(angle) * radius;
                const y = Math.sin(angle) * radius;
                
                // è®¾ç½®å­èŠ‚ç‚¹ä½ç½®
                childNode.style.position = 'absolute';
                childNode.style.left = `${x}px`;
                childNode.style.top = `${y}px`;
                childNode.style.transform = 'translate(-50%, -50%)';
                
                console.log(`å­èŠ‚ç‚¹ ${index}: è§’åº¦=${angle * 180 / Math.PI}Â°, x=${x}, y=${y}`);
            });
            
            // è°ƒæ•´å®¹å™¨æ ·å¼ä»¥æ”¯æŒç»å¯¹å®šä½
            childrenContainer.style.position = 'relative';
            childrenContainer.style.width = `${radius * 2 + 100}px`;
            childrenContainer.style.height = `${radius * 2 + 100}px`;
            childrenContainer.style.margin = '0 auto';
        }
        
        // ç»˜åˆ¶è¿æ¥çº¿
        function drawConnectionLines() {
            const mainNode = document.getElementById('mindmapNode');
            const childrenContainer = document.getElementById('mindmapChildren');
            const connectionsContainer = document.getElementById('mindmapConnections');
            const childNodes = childrenContainer.querySelectorAll('.mindmap-child-node');
            
            if (!mainNode || !childrenContainer || childNodes.length === 0) {
                return;
            }
            
            // è·å–ä¸»èŠ‚ç‚¹ä½ç½®
            const mainRect = mainNode.getBoundingClientRect();
            const containerRect = childrenContainer.getBoundingClientRect();
            
            // ä¸»èŠ‚ç‚¹ä¸­å¿ƒç‚¹
            const mainCenterX = mainRect.left + mainRect.width / 2;
            const mainCenterY = mainRect.top + mainRect.height / 2;
            
            childNodes.forEach((childNode, index) => {
                const childRect = childNode.getBoundingClientRect();
                
                // å­èŠ‚ç‚¹ä¸­å¿ƒç‚¹
                const childCenterX = childRect.left + childRect.width / 2;
                const childCenterY = childRect.top + childRect.height / 2;
                
                // è®¡ç®—è¿æ¥çº¿
                const startX = mainCenterX - containerRect.left;
                const startY = mainCenterY - containerRect.top;
                const endX = childCenterX - containerRect.left;
                const endY = childCenterY - containerRect.top;
                
                // åˆ›å»ºè¿æ¥çº¿å…ƒç´ 
                const line = document.createElement('div');
                line.className = 'connection-line';
                
                // è®¡ç®—çº¿çš„é•¿åº¦å’Œè§’åº¦
                const deltaX = endX - startX;
                const deltaY = endY - startY;
                const length = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
                const angle = Math.atan2(deltaY, deltaX) * 180 / Math.PI;
                
                // è®¾ç½®çº¿çš„æ ·å¼
                line.style.left = startX + 'px';
                line.style.top = startY + 'px';
                line.style.width = length + 'px';
                line.style.transform = `rotate(${angle}deg)`;
                
                console.log(`è¿æ¥çº¿ ${index}: é•¿åº¦=${length}px, è§’åº¦=${angle}Â°`);
                
                connectionsContainer.appendChild(line);
            });
        }
        
        // æµ‹è¯•æ”¾å°„çŠ¶å¸ƒå±€
        function testRadialLayout() {
            console.log('æµ‹è¯•æ”¾å°„çŠ¶å¸ƒå±€...');
            showMindMap();
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨æ˜¾ç¤ºæ€ç»´å¯¼å›¾
        document.addEventListener('DOMContentLoaded', function() {
            console.log('é¡µé¢åŠ è½½å®Œæˆï¼Œå¯ä»¥ç‚¹å‡»æŒ‰é’®æµ‹è¯•æ€ç»´å¯¼å›¾');
        });
    </script>
</body>
</html> 